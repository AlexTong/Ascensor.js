/*
Ascensor.js 
version: 1.8.1 (2014-02-24)
description: Ascensor is a jquery plugin which aims to train and adapt content according to an elevator system
repository: https://github.com/kirkas/Ascensor.js
license: BSD
author: LÃ©o Galley <contact@kirkas.ch>
*/
!function(a,b,c,d){function e(b,c){this.element=b,this.options=a.extend({},i,c),this._defaults=i,this._name=h,this.init()}function f(){var a,e=c.createElement("p"),f={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};c.body.insertBefore(e,null);for(var g in f)e.style[g]!==d&&(e.style[g]="translate3d(1px,1px,1px)",a=b.getComputedStyle(e).getPropertyValue(f[g]));return c.body.removeChild(e),a!==d&&a.length>0&&"none"!==a}function g(a,b){var c=a.indexOf(b);return-1!==c?!0:!1}var h="ascensor",i={ascensorFloorName:null,childType:"div",windowsOn:0,direction:"y",loop:!1,width:"100%",height:"100%",time:300,easing:"linear",keyNavigation:!0,queued:!1,jump:!1,ready:!1};Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),e.prototype={init:function(){var b=this;this.AXIS_X=1,this.AXIS_Y=0,this.node=a(this.element),this.nodeChildren=this.node.children(this.options.childType),this.floorActive=this._getFloorFromHash()?this._getFloorFromHash():this.options.windowsOn,this.NH=this.node.height(),this.NW=this.node.width(),this.directionIsArray="object"==typeof this.options.direction,this.supportTransform=f(),this.setup(function(){"function"==typeof b.options.ready&&b.options.ready()})},setup:function(d){var e=this;this.directionIsArray&&this._generateFloorMap(),this.node.css({position:"absolute",overflow:"hidden",top:"0",left:"0",width:this.options.width,height:this.options.height}),this.nodeChildren.css({position:"absolute",overflow:"auto",top:"0",left:"0",width:"100%",height:"100%"}),this.nodeChildren.each(function(b){a(this).css(e.supportTransform?{transform:function(){return"y"===e.options.direction?"translateY("+100*b+"%)":"x"===e.options.direction?"translateX("+100*b+"%)":e.directionIsArray?"translateY("+100*e.options.direction[b][e.AXIS_Y]+"%) translateX("+100*e.options.direction[b][e.AXIS_X]+"%)":void 0}}:{top:function(){return"y"===e.options.direction?100*b+"%":e.directionIsArray?100*e.options.direction[b][e.AXIS_Y]+"%":void 0},left:function(){return"x"===e.options.direction?100*b+"%":e.directionIsArray?100*e.options.direction[b][e.AXIS_X]+"%":void 0}})}),this.node.on("scrollToDirection",function(a,b){e._handleDirection(b)}),this.node.on("scrollToStage",function(b,c){if("string"==typeof c){var d=a.inArray(c,e.options.ascensorFloorName);-1!==d&&this.scrollToFloor(d)}else if("number"==typeof c){if(c>e.nodeChildren.length)return;e.scrollToFloor(c)}}),this.node.on("next",function(){e.next()}),this.node.on("prev",function(){e.prev()}),this.node.on("refresh",function(){e.setup()}),a(b).bind("resize",function(){e.scrollToFloor(e.floorActive,!1)}),a(b).bind("hashchange",function(a){e._hashchangeHandler(a)}),b.DeviceOrientationEvent&&a(b).bind("orientationchange",function(){e.scrollToFloor(e.floorActive)}),this.options.keyNavigation&&a(c).bind("keyup keypress",function(a){e._keypressHandler(a)}),this.scrollToFloor(e.floorActive),"function"==typeof d&&d()},_getFloorFromHash:function(){if(b.location.hash){var a=b.location.hash.split("#").pop();if(this.options.ascensorFloorName&&g(this.options.ascensorFloorName,a))return this.options.ascensorFloorName.indexOf(a)}return!1},_hashchangeHandler:function(){this._getFloorFromHash()&&!this.node.is(":animated")&&this.scrollToFloor(self._getFloorFromHash())},_emitEvent:function(a,b,c){this.node.trigger(a,floor={from:b,to:c})},_keypressHandler:function(b){var c=this,d=b.keyCode||b.which;if(!a("input, textarea, button").is(":focus"))switch(d){case 40:case 83:c._handleDirection("down");break;case 38:case 87:c._handleDirection("up");break;case 37:case 65:c._handleDirection("left");break;case 39:case 68:c._handleDirection("right")}},scrollToFloor:function(a){var c=this,d=d||(a==this.floorActive?!1:!0);this.NW!==this.node.width()&&(this.NW=this.node.width()),this.NH!==this.node.height()&&(this.NH=this.node.height());var e=this._getAnimationSettings(a);d?(this._emitEvent("scrollStart",c.floorActive,a),this.node.stop().animate(e.property,c.options.time,c.options.easing,e.callback)):this.node.stop().scrollTop(e.property.scrollTop).scrollLeft(e.property.scrollLeft),a!==this.floorActive&&(c.options.ascensorFloorName&&b.location.replace((""+b.location).split("#")[0]+"#"+c.options.ascensorFloorName[a]),c.floorActive=a,this.node.data("current-floor",c.floorActive))},prev:function(){var a=this.floorActive-1;if(0>a){if(!this.options.loop)return;a=this.nodeChildren.length}this.scrollToFloor(a)},next:function(){var a=this.floorActive+1;if(a>this.nodeChildren.length){if(!this.options.loop)return;a=0}this.scrollToFloor(a)},_getAnimationSettings:function(a){var b=this,c={property:{},callback:function(){b._emitEvent("scrollEnd",b.floorActive,a)}},d={property:{},callback:function(){b._emitEvent("scrollEnd",b.floorActive,a)}};if("y"===b.options.direction)return c.property.scrollTop=a*b.NH,c;if("x"===b.options.direction)return c.property.scrollLeft=a*b.NW,c;if(b.directionIsArray){var e=b.options.direction[a][b.AXIS_Y]*b.NH,f=b.options.direction[a][b.AXIS_X]*b.NW;if(b.options.queued){{var g=this.node.scrollLeft()===f;this.node.scrollTop()===e}return"x"===b.options.queued&&g?(c.property.scrollTop=e,c):(c.property.scrollLeft=f,d.property.scrollTop=e,c.callback=function(){b.node.stop().animate(d.property,b.options.time,b.options.easing,d.callback)},c)}return c.property.scrollTop=e,c.property.scrollLeft=f,c}return c},_handleDirection:function(a){function b(a){return a===!1}var c=this;if(!("y"==c.options.direction&&"left"==a||"x"==c.options.direction&&"up"==a)){if("y"==c.options.direction&&"down"==a||"x"==c.options.direction&&"right"==a)return c.next();if("y"==c.options.direction&&"up"==a||"x"==c.options.direction&&"left"==a)return c.prev();if(c.directionIsArray){var d;if(b(c.floorMap[c.floorActive][a]))if(c.options.jump===!0&&c.floorMap[c.floorActive].closest[a]!==!1)d=c.floorMap[c.floorActive].closest[a];else if(c.options.loop===!0)d=c.floorMap[c.floorActive].furthest[a];else if("loop-x"!=c.options.loop||"right"!=a&&"left"!=a||c.floorMap[c.floorActive].furthest[a]===!1)if("loop-y"!=c.options.loop||"down"!=a&&"up"!=a||c.floorMap[c.floorActive].furthest[a]===!1){if("string"==typeof c.options.loop){var e=("down"==a||"up"==a)&&"increment-y"==c.options.loop,f=("right"==a||"left"==a)&&"increment-x"==c.options.loop;if(c.floorMap[c.floorActive].increment[a]!==!1)(e||f||"increment"==c.options.loop)&&(d=c.floorMap[c.floorActive].increment[a]);else if("right"==a||"left"==a){if("increment-y"==c.options.loop)return;c.floorActive==c.floorMap.furthest_x?d=c.floorMap.closest_x:c.floorActive==c.floorMap.closest_x&&(d=c.floorMap.furthest_x)}else if("down"==a||"up"==a){if("increment-x"==c.options.loop)return;c.floorActive==c.floorMap.furthest_y?d=c.floorMap.closest_y:c.floorActive==c.floorMap.closest_y&&(d=c.floorMap.furthest_y)}}}else d=c.floorMap[c.floorActive].furthest[a];else d=c.floorMap[c.floorActive].furthest[a];else d=c.floorMap[c.floorActive][a];"number"==typeof d&&c.scrollToFloor(d)}}},_generateFloorMap:function(){function b(b,c,d,e){var f=b[d],g=!1;return a.each(c,function(){(("right"==e||"down"==e)&&this[d]>b[d]||("left"==e||"up"==e)&&this[d]<b[d])&&(!g||Math.abs(this[d]-f)<Math.abs(g[d]-f))&&(g=this)}),g&&-1!==k.indexOf(g)?k.indexOf(g):!1}function c(b,c,d){var e=b[d],f=!1;return a.each(c,function(){(!f||Math.abs(this[d]-e)>Math.abs(f[d]-e))&&(f=this)}),f&&-1!==k.indexOf(f)?k.indexOf(f):!1}function d(b,c){var d=0,e=!1;return a.each(b,function(){(!e||Math.abs(this[c]-d)>Math.abs(e[c]-d))&&(e=this)}),e&&-1!==k.indexOf(e)?k.indexOf(e):!1}function e(b,c){var d=0,e=!1;return a.each(b,function(){(!e||Math.abs(this[c]-d)>Math.abs(e[c]-d))&&(e=this)}),e&&-1!==k.indexOf(e)?k.indexOf(e):!1}function f(a,b,c,d){return c[0]+a==d[0]&&c[1]+b==d[1]?k.indexOf(d):!1}function g(a,b){var c=!1;return jQuery.each(a,function(a,d){(c===!1||c[b]<d[b])&&(c=d)}),c}function h(a,b){var c=!1;return jQuery.each(a,function(a,d){(c===!1||c[b]>d[b])&&(c=d)}),c}function i(a,b){return jQuery.grep(k,function(c){var d=c[b]==a[b];return d})}var j=this;this.floorMap=[];var k=jQuery.grep(j.options.direction,function(a,b){return j.node.children().length>b}),l=g(k,1),m=i(l,1),n=g(m,0),o=g(k,0),p=i(o,0),q=g(p,1);this.floorMap.furthest_x=k.indexOf(q),this.floorMap.furthest_y=k.indexOf(n);var r=h(k,1),s=i(r,1),t=h(s,0),u=h(k,0),v=i(u,0),w=h(v,1);this.floorMap.closest_x=k.indexOf(w),this.floorMap.closest_y=k.indexOf(t),a.each(k,function(g,h){var i=jQuery.grep(k,function(a){var b=a[0]==h[0],c=h==a;return b&&!c}),l=jQuery.grep(k,function(a){var b=a[1]==h[1],c=h==a;return b&&!c}),m=jQuery.grep(k,function(a){var b=a[0]==h[0]+1;return b}),n=jQuery.grep(k,function(a){var b=a[0]==h[0]-1;return b}),o=jQuery.grep(k,function(a){var b=a[1]==h[1]+1;return b}),p=jQuery.grep(k,function(a){var b=a[1]==h[1]-1;return b});j.floorMap[g]={down:!1,up:!1,right:!1,left:!1,increment:{down:d(o,1),up:e(p,0),right:d(m,0),left:e(n,1)},closest:{down:b(h,l,0,"down"),up:b(h,l,0,"up"),right:b(h,i,1,"right"),left:b(h,i,1,"left")},furthest:{down:c(h,l,0,"down"),up:c(h,l,0,"up"),right:c(h,i,1,"right"),left:c(h,i,1,"left")}},a.each(k,function(a,b){j.floorMap[g].down===!1&&(j.floorMap[g].down=f(1,0,h,b)),j.floorMap[g].up===!1&&(j.floorMap[g].up=f(-1,0,h,b)),j.floorMap[g].right===!1&&(j.floorMap[g].right=f(0,1,h,b)),j.floorMap[g].left===!1&&(j.floorMap[g].left=f(0,-1,h,b))})})}},a.fn[h]=function(b){return this.each(function(){a.data(this,"plugin_"+h)||a.data(this,"plugin_"+h,new e(this,b))}),this}}(jQuery,window,document);